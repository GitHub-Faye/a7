# Task ID: 2
# Title: Implement User Authentication System
# Status: pending
# Dependencies: 1
# Priority: high
# Description: Develop the user authentication and authorization system based on Django's built-in authentication.
# Details:
Extend Django's built-in User model to include role-based permissions. Implement login, logout, and password change functionalities. Ensure the system supports multiple roles (teacher, student, admin) with appropriate permissions.

# Test Strategy:
Test user registration, login, logout, and password change functionalities. Verify role-based access control.

# Subtasks:
## 1. Extend User model for roles [done]
### Dependencies: None
### Description: Modify the existing User model to include role fields and relationships.
### Details:
Add role fields (e.g., admin, user) and ensure the database schema is updated.
<info added on 2025-05-20T03:37:48.480Z>
The User model has been successfully extended to include role fields and support a multi-role permission management system. Key implementations include: 1. Created a users app with a custom User model inheriting from AbstractUser. 2. Added role selection fields (admin/teacher/student) and a creation timestamp field. 3. Established a separate Role model for granular permission control. 4. Implemented a full user management API (CRUD operations) with permission controls. 5. Custom permission classes (IsAdminOrReadOnly, IsUserOwnerOrStaff) were developed. 6. Configured the Django Admin interface for user management. 7. Custom serializers handle user creation and updates. 8. Integrated JWT Token authentication. The code structure includes models.py (User and Role models), serializers.py (user and role serializers), views.py (UserViewSet and RoleViewSet), permissions.py (custom permission classes), urls.py (API routing), admin.py (Admin configuration), signals.py (user creation signals), and apps.py (app configuration). Database migrations are complete, and the system now supports user role management functionality.
</info added on 2025-05-20T03:37:48.480Z>

## 2. Implement login/logout [done]
### Dependencies: 2.1
### Description: Develop the login and logout functionalities for user authentication.
### Details:
Create endpoints for login/logout, handle session management, and secure token generation.
<info added on 2025-05-20T12:57:21.151Z>
Create endpoints for login/logout, handle session management, and secure token generation. Implemented features include: 1. Added token_blacklist to INSTALLED_APPS and configured JWT blacklist functionality. 2. Created CustomTokenObtainPairView for login, returning tokens and user information. 3. Implemented LogoutView to add refresh tokens to the blacklist. 4. Added corresponding URL routing configurations. 5. Conducted full functional testing via HTML/JS client. 6. Automated testing performed using Playwright. Testing confirmed successful token retrieval for protected resources post-login and secure token blacklisting post-logout.
</info added on 2025-05-20T12:57:21.151Z>

## 3. Implement password change [done]
### Dependencies: 2.2
### Description: Allow users to change their passwords securely.
### Details:
Develop a password change feature with validation and encryption.
<info added on 2025-05-20T15:12:11.508Z>
The password change feature has been successfully implemented with the following details:

1. **PasswordChangeSerializer**: Created to validate the old password, ensure the new password matches the confirmation, and enforce complexity requirements. Validation rules include:
   - Verifying the old password is correct
   - Ensuring the new password is at least 8 characters long
   - Confirming the new password matches the confirmation
   - Requiring the new password to include both letters and numbers

2. **UserViewSet Integration**: Added a `change_password` method to provide the password change API endpoint:
   - Endpoint: `/api/users/change_password/`
   - Method: POST
   - Authentication: JWT Token required
   - Parameters: `old_password`, `new_password`, `confirm_password`

3. **Test Page Updates**: Enhanced the test page `test_html/auth_test.html` with:
   - A password change form (old password, new password, confirmation)
   - JavaScript function `changePassword()` to handle requests
   - Improved UI with color-coded buttons
   - User-friendly status feedback

4. **Automated Testing**: Conducted Playwright tests to verify:
   - Password validation rules (including length)
   - Successful password updates (old password invalid, new password valid)
   - Error handling with appropriate messages

The implementation adheres to RESTful API best practices and integrates seamlessly with Django's built-in password management, using `set_password()` for secure storage.
</info added on 2025-05-20T15:12:11.508Z>

## 4. Set up role-based permissions [pending]
### Dependencies: 2.1
### Description: Define and enforce permissions based on user roles.
### Details:
Create middleware or logic to restrict access based on roles (e.g., admin-only routes).

## 5. Test all functionalities [pending]
### Dependencies: 2.2, 2.3, 2.4
### Description: Verify that all authentication and role-based features work as expected.
### Details:
Write and execute test cases for login, logout, password change, and role permissions.

